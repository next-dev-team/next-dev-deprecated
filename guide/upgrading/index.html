<!DOCTYPE html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel="shortcut icon" href="https://gw.alipayobjects.com/zos/bmw-prod/d3e3eb39-1cd7-4aa5-827c-877deced6b7e/lalxt4g3_w256_h256.png">
<link rel="stylesheet" href="/next-dev/umi.58646bc0.css">
<title data-rh="true">从 dumi 1.x 升级</title>
<meta data-rh="true" property="og:title" content="从 dumi 1.x 升级"/><meta data-rh="true" name="description" content="参考该文档可将 dumi 1.x 项目升级到 dumi 2.0，如果你的项目是从 dumi 1.x 早期的组件研发脚手架初始化，建议同时将项目中的 father-build 升级到 father 4，以获得更好的组件源码构建体验。"/><meta data-rh="true" property="og:description" content="参考该文档可将 dumi 1.x 项目升级到 dumi 2.0，如果你的项目是从 dumi 1.x 早期的组件研发脚手架初始化，建议同时将项目中的 father-build 升级到 father 4，以获得更好的组件源码构建体验。"/>
</head>
<body>
<noscript><b>Enable JavaScript to run this app.</b></noscript><div id="root"><!--$?--><template id="B:0"></template><div></div><!--/$--></div><script>window.__UMI_LOADER_DATA__ = {}</script>
<script src="/next-dev/umi.3ad2b7a6.js"></script>

</body></html><div hidden id="S:0"><!--$?--><template id="B:1"></template><div></div><!--/$--></div><script>function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("B:0","S:0")</script><div hidden id="S:1"><div class="dumi-default-doc-layout"><div class="dumi-default-header"><div class="dumi-default-header-content"><section class="dumi-default-header-left"><a class="dumi-default-logo" href="/"><img src="https://gw.alipayobjects.com/zos/bmw-prod/d3e3eb39-1cd7-4aa5-827c-877deced6b7e/lalxt4g3_w256_h256.png" alt="Next Dev"/>Next Dev<!-- --></a></section><section class="dumi-default-header-right"><ul class="dumi-default-navbar"><li><a class="active" href="/guide">Guide</a></li><li><a href="/blog/e1_umi4">Blog</a></li></ul><div class="dumi-default-header-right-aside"><div class="dumi-default-search-bar"><svg viewBox="64 64 896 896"><path d="M909.6 854.5 649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg><input placeholder="Type keywords..."/><span class="dumi-default-search-shortcut">⌘<!-- --> K<!-- --></span></div><a class="dumi-default-lang-switch" href="/kh-Km/guide/upgrading">ខ្មែរ</a></div></section><button type="button" class="dumi-default-header-menu-btn"><svg viewBox="64 64 896 896"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></button></div></div><div class="dumi-default-doc-layout-mobile-bar"><button type="button" class="dumi-default-sidebar-btn"><svg viewBox="64 64 896 896"><path d="M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"></path></svg>Sidebar<!-- --></button></div><main><div class="dumi-default-sidebar"><dl class="dumi-default-sidebar-group"><dt>介绍</dt><dd><a title="Guide" class="" href="/guide">Guide</a></dd></dl><dl class="dumi-default-sidebar-group"><dt>基础</dt><dd><a title="初始化" class="" href="/guide/initialize">初始化</a></dd><dd><a title="目录结构" class="" href="/guide/project-structure">目录结构</a></dd><dd><a title="约定式路由" class="" href="/guide/conventional-routing">约定式路由</a></dd><dd><a title="页面渲染配置" class="" href="/guide/page-config">页面渲染配置</a></dd><dd><a title="写组件 demo" class="" href="/guide/write-demo">写组件 demo</a></dd><dd><a title="Markdown 增强" class="" href="/guide/markdown">Markdown 增强</a></dd></dl><dl class="dumi-default-sidebar-group"><dt>进阶</dt><dd><a title="多语言" class="" href="/guide/i18n">多语言</a></dd><dd><a title="页面 Tab" class="" href="/guide/page-tab">页面 Tab</a></dd></dl><dl class="dumi-default-sidebar-group"><dt>其他</dt><dd><a title="从 dumi 1.x 升级" aria-current="page" class="active" href="/guide/upgrading">从 dumi 1.x 升级</a></dd><dd><a title="常见问题" class="" href="/guide/faq">常见问题</a></dd></dl></div><div class="dumi-default-content"><!--$?--><template id="B:2"></template><div></div><!--/$--><div class="dumi-default-footer">Open-source MIT Licensed | Copyright © 2019-present
<br />
Powered by self</div></div></main></div></div><script>$RC("B:1","S:1")</script><div hidden id="S:2"><div class="markdown"><h1 id="从-dumi-1x-升级"><a aria-hidden="true" tabindex="-1" href="#从-dumi-1x-升级"><span class="icon icon-link"></span></a>从 dumi 1.x 升级<!-- --></h1><p>参考该文档可将 dumi 1.x 项目升级到 dumi 2.0，如果你的项目是从 dumi 1.x 早期的组件研发脚手架初始化，建议同时将项目中的 father-build <!-- --><a href="https://github.com/umijs/father/blob/master/docs/guide/upgrading.md">升级到 father 4</a>，以获得更好的组件源码构建体验。<!-- --></p><h2 id="环境检查"><a aria-hidden="true" tabindex="-1" href="#环境检查"><span class="icon icon-link"></span></a>环境检查<!-- --></h2><p>dumi 2.0 最低支持 Node.js v14 版本，升级前请确保设备安装的 Node.js 版本是 14+。</p><h2 id="项目模板升级"><a aria-hidden="true" tabindex="-1" href="#项目模板升级"><span class="icon icon-link"></span></a>项目模板升级<!-- --></h2><h3 id="方案一重新初始化"><a aria-hidden="true" tabindex="-1" href="#方案一重新初始化"><span class="icon icon-link"></span></a>方案一：重新初始化<!-- --></h3><p>倘若在 dumi 1.x 初始化模板的基础上改动不大，建议<!-- --><a href="/guide/upgrading/initialize">使用 <!-- --><code>create-dumi</code> 重新初始化<!-- --></a>一套模板，将源码及文档拷贝进去、再做适当调整验证。<!-- --></p><p>确保以下操作是在 git 仓库中进行，且工作区是干净的：</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-bash"><div class="token-line"><span class="token plain">$ </span><span class="token function">git</span><span class="token plain"> </span><span class="token function">rm</span><span class="token plain"> -rf ./*        </span><span class="token comment"># 清空现有仓库文件（仅工作区清空，文件仍受 Git 版本控制）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ npx create-dumi       </span><span class="token comment"># 然后选择需要的模板</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ </span><span class="token function">rm</span><span class="token plain"> -rf docs src       </span><span class="token comment"># 删除初始化模板的 docs 及 src</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ </span><span class="token function">git</span><span class="token plain"> checkout src docs </span><span class="token comment"># 恢复原有的源码及文档</span></div></pre></div><p>至此模板升级完成，可进行后续的文档及配置升级。</p><h3 id="方案二手动升级"><a aria-hidden="true" tabindex="-1" href="#方案二手动升级"><span class="icon icon-link"></span></a>方案二：手动升级<!-- --></h3><p>倘若在 dumi 1.x 初始化模板的基础上改动较大，建议手动升级做最小化调整，步骤如下：</p><h4 id="更新-packagejson"><a aria-hidden="true" tabindex="-1" href="#更新-packagejson"><span class="icon icon-link"></span></a>更新 package.json<!-- --></h4><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class="token-line"><span class="token plain">{</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> &quot;scripts&quot;: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   &quot;prepare&quot;: &quot;dumi setup&quot;</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> },</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> &quot;devDependencies&quot;: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   &quot;dumi&quot;: &quot;^1.0.0&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   &quot;dumi&quot;: &quot;^2.0.0-rc.0&quot;</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">}</span></div></pre></div><h4 id="更新-tsconfigjson"><a aria-hidden="true" tabindex="-1" href="#更新-tsconfigjson"><span class="icon icon-link"></span></a>更新 tsconfig.json<!-- --></h4><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class="token-line"><span class="token plain">{</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> &quot;compilerOptions&quot;: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   &quot;paths: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">     &quot;@@/*&quot;: [&quot;.dumi/tmp/*&quot;]</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">}</span></div></pre></div><h4 id="更新-gitignore"><a aria-hidden="true" tabindex="-1" href="#更新-gitignore"><span class="icon icon-link"></span></a>更新 .gitignore<!-- --></h4><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> .umi</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> .umi-test</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> .umi-production</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> .dumi/tmp</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> .dumi/tmp-test</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> .dumi/tmp-production</span></div></pre></div><h2 id="项目文件升级"><a aria-hidden="true" tabindex="-1" href="#项目文件升级"><span class="icon icon-link"></span></a>项目文件升级<!-- --></h2><p>dumi 2.0 将使用特有的 <!-- --><code>.dumirc.ts</code> 作为配置文件，请将原有的 <!-- --><code>.umirc.ts</code> 或者 <!-- --><code>config/config.ts</code> 重命名为 <!-- --><code>.dumirc.ts</code>，并做如下调整：<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class="token-line"><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> import { defineConfig } from &#x27;dumi&#x27;;</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> export default {</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> export defualt defineConfig({</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # 以下为文档配置升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # 已内置全文搜索，默认不再集成 algolia，有需要可以手动覆盖 SearchBar 组件</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  algolia: { ... },</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # 由于 doc 模式已废弃，所以该配置项也一并废弃</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  mode: &#x27;doc&#x27;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # dumi 1.x 用 title 作为组件库名称，如果你希望设置的是组件库名称而非页面标题，请改用 name</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  title: &#x27;xxx&#x27;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  themeConfig: { name: &#x27;xxx&#x27; },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # logo 配置项升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  logo: &#x27;xxx&#x27;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  themeConfig: { logo: &#x27;xxx&#x27; },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # menus   升级为 themeConfig.sidebar</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  menus: [...],</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  themeConfig: {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    sidebar: {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">      &#x27;/guide&#x27;: {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">        title: &#x27;分组名称（可选）&#x27;,</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">        children: [{ title: &#x27;标题&#x27;, link: &#x27;链接&#x27; }],</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">      },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # navs 升级为 themeConfig.nav</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  navs: [...],</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  themeConfig: {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    nav: [{ title: &#x27;标题&#x27;, link: &#x27;链接&#x27; }],</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # locales 配置格式升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  locales: [[&#x27;zh-CN&#x27;, &#x27;中文&#x27;]],</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  locales: [{ id: &#x27;zh-CN&#x27;, name: &#x27;中文&#x27; }], // 2.0 默认值</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # resolve 配置项升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  resolve: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # 拆分普通文档解析（多层）和资产文档（单层 + 按分类添加路由前缀）解析，可访问约定式路由了解更多</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">    includes: [&#x27;docs&#x27;, &#x27;src&#x27;],</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    docDirs: [&#x27;docs&#x27;], // 2.0 默认值</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    atomDirs: [{ type: &#x27;component&#x27;, dir: &#x27;src&#x27; }], // 2.0 默认值</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # passive 配置项升级，用 codeBlockMode 替代</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">    passivePreview: true,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    codeBlockMode: &#x27;passive&#x27;,</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # 废弃，由注册的技术栈决定解析什么语言的 demo</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">    previewLangs: [...],</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  },</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  sitemap: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">    excludes: [...],</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # sitemap.excludes 配置项升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    exclude: [...],</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  },</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # apiParser 的子配置项暂不支持，后续版本会支持</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  apiParser: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">    ...</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  },</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # 以下为基础配置升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # favicon 配置项升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  favicon: &#x27;xxx&#x27;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  favicons: [&#x27;xxx&#x27;],</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # 已废弃，默认开启动态加载</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  dynamicImport: {},</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # 默认开启</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  fastRefresh: {},</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # 默认使用 webpack 5</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  webpack5: {},</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token plain">});</span></div></pre></div><h2 id="目录结构升级"><a aria-hidden="true" tabindex="-1" href="#目录结构升级"><span class="icon icon-link"></span></a>目录结构升级<!-- --></h2><p>由于 dumi 2.0 拆分了普通文档与资产文档的解析逻辑，其中资产文档的解析<!-- --><strong>仅识别解析路径顶层 md 及顶层下的 index.md</strong>，所以在 <!-- --><code>src</code> 下的文档目录结构可能需要做调整，例如：<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-bash"><div class="token-line"><span class="token builtin class-name">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">└── src</span></div><div class="token-line"><span class="token plain">    ├── Foo</span></div><div class="token-line"><span class="token plain">    │   ├── index.md     </span><span class="token comment"># ✅ 识别</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    │   └── a.md         </span><span class="token comment"># ❗️ 非 index.md 不再识别</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    ├── components</span></div><div class="token-line"><span class="token plain">    │   └── Bar</span></div><div class="token-line"><span class="token plain">    │       └── index.md </span><span class="token comment"># ❗️ 嵌套层级不再识别</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    └── Hello.md         </span><span class="token comment"># ✅ 识别</span></div></pre></div><p>如果不方便调整结构，可以通过配置 <!-- --><code>resolve.atomDirs</code> 来指定识别的目录，例如：<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class="token-line"><span class="token plain">export default {</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> resolve: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   atomDirs: [</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     { type: &#x27;component&#x27;, dir: &#x27;src&#x27; }, // 默认值</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     # 追加一个组件资产的解析目录</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">     { type: &#x27;component&#x27;, dir: &#x27;src/components&#x27; },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   ]</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">}</span></div></pre></div><p>Monorepo 模式下</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class="token-line"><span class="token plain">export default {</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> resolve: {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   atomDirs: [</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     { type: &#x27;component&#x27;, dir: &#x27;src&#x27; }, // 默认值</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     # 做顶级路由的区分，被解析到的 md 均有对应 `type` 复数形式的路由前缀，例如 `/basic-components/foo`</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">     { type: &#x27;basic-component&#x27;, dir: &#x27;packages/basic/src&#x27; },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">     { type: &#x27;complex-component&#x27;, dir: &#x27;packages/complex/src&#x27; },</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   ]</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">}</span></div></pre></div><h2 id="frontmatter-升级"><a aria-hidden="true" tabindex="-1" href="#frontmatter-升级"><span class="icon icon-link"></span></a>FrontMatter 升级<!-- --></h2><p>Markdown 头部支持的 frontmatter 有如下变化：</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class="token-line"><span class="token coord">---</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> nav:</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   # 不支持配置路径，以文件夹目录结构为准</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   path: /xxxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> group:</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   # 不支持配置路径，group 没有路径的概念了</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   path: /xxxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> # 已废弃</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> legacy: /xxxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> hero:</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   # 新的默认主题不支持展示 hero 图片</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   image: xxxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   # desc 配置项升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   desc: xxxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   description: xxxx</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> features:</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   # 新的默认主题只支持配置 emoji 作为图标</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   - icon: xxxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   - emoji: 🚀</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   # desc 配置项升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">     desc: xxxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">     description: xxxx</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> # 请在 .dumirc.ts 的 themeConfig.footer 中配置</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> footer: xxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> # 已废弃</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> translateHelp: true</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> # 以下配置暂不支持，后续版本会支持</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> hide: true</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> sidemenu: false</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token coord">---</span></div></pre></div><p>Demo 支持的 frontmatter 有如下变化：</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class="token-line"><span class="token plain">/**</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # desc 配置项升级</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">* desc: xxxx</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">* description: xxxx</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # 已废弃，可通过覆盖 PreviewerActions 组件实现全局控制</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">* hideActions: [&#x27;xxx&#x27;]</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> # 以下配置暂不支持，后续版本会支持</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">* defaultShowCode: true</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">* debug: true</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">*/</span></div></pre></div><p>至此，可以启动 dev server 验证项目运行情况，如果没什么异常就意味着升级完成了，如果升级过程中碰到任何问题，欢迎到 <!-- --><a href="https://github.com/umijs/dumi/discussions/1216">GitHub 讨论区</a>内反馈。<!-- --></p></div></div><script>$RC("B:2","S:2")</script>